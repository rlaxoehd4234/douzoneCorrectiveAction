<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.comet.service.eh.abc.dao.Abc00200DAO">

	<select id="selectAbc00200ModelList" resultType="com.douzone.comet.service.eh.abc.models.Abc00200Model">		
		SELECT ECRM2.COMPANY_CD 
		      ,ECRM2.CRCT_TRMT_NO
		      ,ECRM2.SQ_NO
		      ,ECRM2.TRMT_TM_CNT 
		      ,ECRM2.WRT_TM_CNT 
		      ,ECRM2.ISSUE_EMP_NO
		      ,ECRM2.ISSUE_DT
		      ,ECRM2.SURCHRG_AMT 
		      ,ECRM2.CUS_ANAL_TXT 
		      ,ECRM2.TRMT_CNTN_TXT
		      ,ECRM2.PRVN_TRMT_N_CTMSR_TXT 
		      ,ECRM2.FG_CD 
		      ,ECRM2.ATCHFILE_ID 
		      ,ECRM2.IMG_PATH_DC 
		      ,ECRM2.INSERT_ID 
		      ,ECRM2.INSERT_DTS 
		      ,ECRM2.UPDATE_ID 
		      ,ECRM2.UPDATE_DTS 
		      ,ECRM2.RST_GOAL_DT 
		      ,ECRM3.REVIEW_RST_FG
		      ,ECD3.MNG_DTL_NM AS REVIEW_RST_FG_NM
		      ,CFI.FILE_DC 
			  ,CFI2.FILE_DC AS IMG_FILE_DC
			  ,CFI2.NEW_FILE_DC AS IMG_NEW_FILE_DC
			  ,CFI2.FILE_SQ AS IMG_FILE_SQ
			  ,CFI2.ORGL_FILE_DC AS IMG_ORGL_FILE_DC
			  ,CFI2.ORGL_FEXTSN_DC AS IMG_ORGL_FEXTSN_DC
			  ,CFI2.FILE_VR AS IMG_FILE_VR
		      ,MDM.DEPT_CD AS ISSUE_DEPT_CD
		      ,MDM.DEPT_NM AS ISSUE_DEPT_NM
		      ,HEM.KOR_NM AS ISSUE_EMP_NM
		      ,ECRM.CRCT_TRMT_NO AS REQN_CRCT_TRMT_NO
		      ,ECRM.SQ_NO AS REQN_SQ_NO
		      ,ECRM.CRCT_TRMT_NM AS REQN_CRCT_TRMT_NM
		      ,ECRM.CRCT_TRMT_REQN_DT AS REQN_CRCT_TRMT_REQN_DT
		      ,ECRM.TRMT_TRGT_CD AS REQN_TRMT_TRGT_CD
		      ,MDM2.DEPT_NM AS REQN_TRMT_TRGT_NM
		      ,ECRM.ISSUE_EMP_NO AS REQN_ISSUE_EMP_NO	
		      ,ECRM.TRMT_GOAL_DT AS REQN_TRMT_GOAL_DT
		      ,ECRM.REL_BSS_TXT AS REQN_REL_BSS_TXT
		      ,ECRM.PTG_MATTER_TXT AS REQN_PTG_MATTER_TXT
		      ,ECRM.CRCT_TRMT_TXT AS REQN_CRCT_TRMT_TXT
		      ,ECRM.ATCHFILE_ID AS REQN_ATCHFILE_ID
		      ,ECRM.IMG_PATH_DC AS REQN_IMG_PATH_DC
		      ,ECRM.ISSUE_TP AS REQN_ISSUE_TP
		      ,ECRM.FG_CD AS REQN_FG_CD
		      ,ECRM.PLANT_CD AS REQN_PLANT_CD
		      ,ECD.MNG_DTL_NM AS REQN_ISSUE_NM
		      ,ECD2.MNG_DTL_NM AS REQN_FG_NM
		      ,MPM.PLANT_NM AS REQN_PLANT_NM
		      ,HEM2.KOR_NM AS REQN_ISSUE_EMP_NM
		      ,HEM2.DEPT_CD AS REQN_ISSUE_DEPT_CD
		      ,MDM3.DEPT_NM AS REQN_ISSUE_DEPT_NM
		      ,HEM2.PSTN_CD AS REQN_ISSUE_EMP_PSTN_CD
		      ,CFI3.FILE_DC AS REQN_FILE_DC
			  ,CFI4.FILE_DC AS REQN_IMG_FILE_DC
			  ,CFI4.NEW_FILE_DC AS REQN_IMG_NEW_FILE_DC
			  ,CFI4.FILE_SQ AS REQN_IMG_FILE_SQ
			  ,CFI4.ORGL_FILE_DC AS REQN_IMG_ORGL_FILE_DC
			  ,CFI4.ORGL_FEXTSN_DC AS REQN_IMG_ORGL_FEXTSN_DC
			  ,CFI4.FILE_VR AS REQN_IMG_FILE_VR
		FROM @{dzparam_dbname}EH_CRCTTRMT_REQN_MST ECRM
		LEFT OUTER JOIN EH_CRCTTRMT_RST_MST ECRM2
			ON ECRM.COMPANY_CD = ECRM2.COMPANY_CD 
			AND ECRM.CRCT_TRMT_NO = ECRM2.CRCT_TRMT_NO 
			AND ECRM.SQ_NO = ECRM2.SQ_NO
		LEFT OUTER JOIN EH_CRCTTRMT_REVIEW_MST ECRM3
			ON ECRM2.COMPANY_CD = ECRM3.COMPANY_CD 
			AND ECRM2.CRCT_TRMT_NO = ECRM3.CRCT_TRMT_NO 
			AND ECRM2.SQ_NO = ECRM3.SQ_NO 
		LEFT OUTER JOIN EH_CODE_DTL ECD
			ON ECRM.ISSUE_TP = ECD.MNG_DTL_CD
			AND ECRM.COMPANY_CD = ECD.COMPANY_CD 
			AND ECD.MCLS_CD = 'M0100'
		LEFT OUTER JOIN EH_CODE_DTL ECD2
			ON ECRM.FG_CD = ECD2.MNG_DTL_CD 
			AND ECRM.COMPANY_CD = ECD2.COMPANY_CD 
			AND ECD2.MCLS_CD = 'M0200'
		LEFT OUTER JOIN EH_CODE_DTL ECD3
			ON ECRM3.REVIEW_RST_FG = ECD3.MNG_DTL_CD 
			AND ECRM3.COMPANY_CD = ECD3.COMPANY_CD 
			AND ECD3.MCLS_CD = 'M0300'
		LEFT OUTER JOIN MA_PLANT_MST MPM
			ON ECRM.COMPANY_CD = MPM.COMPANY_CD 
			AND ECRM.PLANT_CD = MPM.PLANT_CD 
		LEFT OUTER JOIN HR_EMP_MST HEM
			ON ECRM2.COMPANY_CD = HEM.COMPANY_CD 
			AND ECRM2.ISSUE_EMP_NO = HEM.EMP_NO
		LEFT OUTER JOIN HR_EMP_MST HEM2
			ON ECRM.COMPANY_CD = HEM2.COMPANY_CD 
			AND ECRM.ISSUE_EMP_NO = HEM2.EMP_NO
		LEFT OUTER JOIN MA_DEPT_MST MDM
			ON MDM.COMPANY_CD = HEM.COMPANY_CD 
			AND MDM.DEPT_CD = HEM.DEPT_CD 
			AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN MDM.DEPT_START_DT AND NVL(MDM.DEPT_END_DT, TO_CHAR(SYSDATE, 'YYYYMMDD'))
		LEFT OUTER JOIN MA_DEPT_MST MDM2
			ON MDM2.COMPANY_CD = ECRM.COMPANY_CD 
			AND MDM2.DEPT_CD = ECRM.TRMT_TRGT_CD
			AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN MDM2.DEPT_START_DT AND NVL(MDM2.DEPT_END_DT, TO_CHAR(SYSDATE, 'YYYYMMDD'))
		LEFT OUTER JOIN MA_DEPT_MST MDM3
			ON MDM3.COMPANY_CD = HEM2.COMPANY_CD 
			AND MDM3.DEPT_CD = HEM2.DEPT_CD 
			AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN MDM3.DEPT_START_DT AND NVL(MDM3.DEPT_END_DT, TO_CHAR(SYSDATE, 'YYYYMMDD'))
		LEFT OUTER JOIN ( SELECT FILE_DC, MAX(INSERT_DTS) INSERT_DTS FROM CM_FILE_INFO GROUP BY FILE_DC ) CFI
			ON CFI.FILE_DC = ECRM2.ATCHFILE_ID
		LEFT OUTER JOIN CM_FILE_INFO CFI2
			ON CFI2.FILE_DC = ECRM2.IMG_PATH_DC 
		LEFT OUTER JOIN ( SELECT FILE_DC, MAX(INSERT_DTS) INSERT_DTS FROM CM_FILE_INFO GROUP BY FILE_DC ) CFI3
			ON CFI3.FILE_DC = ECRM.ATCHFILE_ID
		LEFT OUTER JOIN CM_FILE_INFO CFI4
			ON CFI4.FILE_DC = ECRM.IMG_PATH_DC 
		WHERE 1 = 1
		<if test='P_COMPANY_CD != null and P_COMPANY_CD != "" '>
			AND ECRM.COMPANY_CD = #{P_COMPANY_CD}
		</if>
		<if test='P_PLANT_CD != null and P_PLANT_CD != "" '>
			AND ECRM.PLANT_CD = #{P_PLANT_CD}
		</if>
		<if test='P_ISSUE_TP != null and P_ISSUE_TP != "" '>
			AND ECRM.ISSUE_TP = #{P_ISSUE_TP}
		</if>
		<if test='P_FG_CD != null and P_FG_CD != "" '>
			AND ECRM.FG_CD = #{P_FG_CD}
		</if>
		<if test='P_CRCT_TRMT_REQN_DT != null and P_CRCT_TRMT_REQN_DT != "" '>
			AND ECRM.CRCT_TRMT_REQN_DT = #{P_CRCT_TRMT_REQN_DT}
		</if>
		<if test='P_CRCT_TRMT_NO != null and P_CRCT_TRMT_NO != "" '>
			AND ECRM.CRCT_TRMT_NO LIKE CONCAT(CONCAT('%',#{P_CRCT_TRMT_NO}), '%')  
		</if>	
		<if test='( P_TRMT_GOAL_DT_START != null and P_TRMT_GOAL_DT_START != "" ) or ( P_TRMT_GOAL_DT_END != null and P_TRMT_GOAL_DT_END != "" )'>
		   	AND ECRM.TRMT_GOAL_DT BETWEEN NVL( #{P_TRMT_GOAL_DT_START}, '00000000') AND NVL( #{P_TRMT_GOAL_DT_END}, '99999999') 
		</if>
		<if test='( P_ISSUE_DT_START != null and P_ISSUE_DT_START != "" ) or ( P_ISSUE_DT_END != null and P_ISSUE_DT_END != "" )'>
		   	AND ECRM2.ISSUE_DT BETWEEN NVL( #{P_ISSUE_DT_START}, '00000000') AND NVL( #{P_ISSUE_DT_END}, '99999999') 
		</if>	
	   	<if test='( P_COMPANY_CD != null and P_COMPANY_CD != "" ) and ( P_ISSUE_DEPT_CD != null and P_ISSUE_DEPT_CD != "" )'>
	   		AND ECRM2.ISSUE_EMP_NO IN ( SELECT EMP_NO
										FROM HR_EMP_MST
										WHERE COMPANY_CD = #{P_COMPANY_CD}
										AND DEPT_CD IN ( SELECT DEPT_CD
														 FROM MA_DEPT_MST 
														 WHERE COMPANY_CD = #{P_COMPANY_CD}
														 AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN MDM.DEPT_START_DT AND NVL(MDM.DEPT_END_DT, TO_CHAR(SYSDATE, 'YYYYMMDD')) 
													  	 AND DEPT_CD = #{P_ISSUE_DEPT_CD} ))
	   	</if>			
	</select>

	<select id="selectAbc00200Model" resultType="com.douzone.comet.service.eh.abc.models.Abc00200Model">		
		SELECT	*
		FROM	@{dzparam_dbname}EH_CRCTTRMT_RST_MST
		WHERE	[columnName] = [columnValue]		
	</select>

	<insert id="insertAbc00200Model">		
		INSERT INTO @{dzparam_dbname}EH_CRCTTRMT_RST_MST (
				[columnName]
		) VALUES (
				[columnValue]
		)		
	</insert>

	<update id="updateAbc00200Model" >		
		UPDATE	@{dzparam_dbname}EH_CRCTTRMT_RST_MST
		SET		TRMT_TM_CNT = #{P_TRMT_TM_CNT}
				,WRT_TM_CNT = #{P_WRT_TM_CNT}
				,ISSUE_EMP_NO = #{P_ISSUE_EMP_NO}
				,ISSUE_DT = #{P_ISSUE_DT}
				,SURCHRG_AMT = #{P_SURCHRG_AMT}
				,CUS_ANAL_TXT = #{P_CUS_ANAL_TXT}
				,TRMT_CNTN_TXT = #{P_TRMT_CNTN_TXT}
				,PRVN_TRMT_N_CTMSR_TXT = #{P_PRVN_TRMT_N_CTMSR_TXT}
				,FG_CD = #{P_FG_CD}
				,ATCHFILE_ID = #{P_ATCHFILE_ID}
				,IMG_PATH_DC = #{P_IMG_PATH_DC}
				,INSERT_ID = #{P_INSERT_ID}
				,INSERT_DTS = #{P_INSERT_DTS}
				,UPDATE_ID = #{P_UPDATE_ID}
				,UPDATE_DTS = #{P_UPDATE_DTS}
				,RST_GOAL_DT = #{P_RST_GOAL_DT}
		WHERE	1 = 1		
			AND	COMPANY_CD = #{P_COMPANY_CD}
			AND	CRCT_TRMT_NO = #{P_CRCT_TRMT_NO}	
			AND	SQ_NO = #{P_SQ_NO}
	</update>

	<delete id="deleteAbc00200Model">		
		DELETE
		FROM	@{dzparam_dbname}EH_CRCTTRMT_RST_MST
		WHERE	1 = 1	
			AND	COMPANY_CD = #{P_COMPANY_CD}
			AND	CRCT_TRMT_NO = #{P_CRCT_TRMT_NO}	
			AND	SQ_NO = #{P_SQ_NO}	
	</delete>

	<delete id="deleteAbc00300Model">		
		DELETE
		FROM	@{dzparam_dbname}EH_CRCTTRMT_REVIEW_MST
		WHERE	1 = 1
			AND	COMPANY_CD = #{P_COMPANY_CD}
			AND	CRCT_TRMT_NO = #{P_CRCT_TRMT_NO}	
			AND	SQ_NO = #{P_SQ_NO}	
	</delete>
	
	<update id="updateRstMst" >		
		UPDATE 	@{dzparam_dbname}EH_CRCTTRMT_RST_MST      
	    SET 	ISSUE_EMP_NO = null
	         	,ISSUE_DT = null
	         	,SURCHRG_AMT = null
	         	,CUS_ANAL_TXT = null
	         	,TRMT_CNTN_TXT = null
	         	,PRVN_TRMT_N_CTMSR_TXT = null
	         	,FG_CD = null
	         	,ATCHFILE_ID = null
	         	,IMG_PATH_DC = null
	         	,INSERT_ID = null
	         	,INSERT_IP = null
	         	,INSERT_DTS = null
	         	,UPDATE_ID = null
	         	,UPDATE_DTS = null
	    WHERE 	1 = 1 
	         	AND COMPANY_CD = #{P_COMPANY_CD}
	         	AND CRCT_TRMT_NO = #{P_CRCT_TRMT_NO}
	         	AND SQ_NO = #{P_SQ_NO}
	</update>
	
	<update id="updateReviewMst" >		
		UPDATE 	@{dzparam_dbname}EH_CRCTTRMT_REVIEW_MST      
	    SET 	ISSUE_EMP_NO = null
	         	,ISSUE_DT = null
	         	,REVIEW_OPN_TXT = null
	         	,REVIEW_RST_FG = null
	         	,RE_CRCT_TRMT_TXT = null
	         	,RE_CRCT_TRMT_REQN_DT = null
	         	,FG_CD = null
	         	,INSERT_ID = null
	         	,INSERT_IP = null
	         	,INSERT_DTS = null
	         	,UPDATE_ID = null
	         	,UPDATE_IP = null
	         	,UPDATE_DTS = null
	    WHERE 	1 = 1 
	         	AND COMPANY_CD = #{P_COMPANY_CD}
	         	AND CRCT_TRMT_NO = #{P_CRCT_TRMT_NO}
	         	AND SQ_NO = #{P_SQ_NO}
	</update>
	
	
</mapper>
